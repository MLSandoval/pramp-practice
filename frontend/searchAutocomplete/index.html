<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Autocomplete</title>
    <!-- Included some basic styling, change at will -->
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/prampcontent/3ea04cbd0f61a798e96afbe5d31ec2f9/raw/e879e32222b543b29a168daa089e2f9f28cf9eb2/autocomplete.css">
</head>
<body>
<form class="search-form">
    <input type="text" class="search-input" placeholder="Start typing a movie title...">
    <ul class="results"></ul>
</form>
<!-- Helper code to provide a search API for mock data -->
<script src="https://cdn.rawgit.com/prampcontent/180077452f9279073cab1035f60d30cf/raw/9cbf891a80bad9ad09c6261ef9578a65502922cc/search_helper.js"></script>
<script type="text/javascript">
    /*-------------------------------
    *
    * Write your JavaScript code here.
    *
    * The mocked search data is available using the searchData async method, e.g:
    *   searchData("QUERY").then(results => ...)
    * ------------------------------*/
  
  let filmsArray = [];
  
  document.addEventListener("DOMContentLoaded", function(event) {

    fetchFilmData();
    assignEventHandlers();
  });

  const fetchFilmData = () => {
    searchData('')
      .then(res=>{
        filmsArray = res;
        console.log(filmsArray)
      })
      .catch(err =>{
        console.errer(err);
      });
  }

  const assignEventHandlers = () => {
    let searchInput = document.querySelector(".search-input");
    let resultsUL = document.querySelector(".results");

    searchInput.addEventListener('input', ()=>{
      searchFilms(searchInput, resultsUL);
    });
  }

  const searchFilms = (inputEl, resultsUL) => {
    if(inputEl.value === ''){
      clearInnerHTML(resultsUL);
    }else{
      const filteredFilms = filmsArray.filter(film => {
      return film.title.toLowerCase().includes(inputEl.value.toLowerCase());
      });

      appendFilteredFilms(filteredFilms, resultsUL);
    }
    
    
  }

  const appendFilteredFilms = (films, resultsUL) => {

    clearInnerHTML(resultsUL);

    films.forEach(film => {
      let li = document.createElement('li');
      li.innerText = `"${film.title}" || ${film.rating}/10`; 
      resultsUL.append(li);
    });
  }

  const clearInnerHTML = (element) => {
    element.innerHTML = '';
  }
</script>
</body>
</html>